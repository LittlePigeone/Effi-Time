{% extends 'index.html' %}


{% block links_block %}
    <link rel="stylesheet" href="../static/first_app/css/canban.css">
{% endblock %}



{% block content %}
    <div class="right_panel glass-block">
        <div class="bottom_buttons">
            <input type="text" class="search glass-block" placeholder="Поиск по названию">
            
            <div class="add_task glass-block" onclick="open_create_task_page()">
                <h1 class="canban_text">Добавить задачу</h1>
            </div>

        </div>
        
        <div class="conban-column">
            <div class="conban-board">
                <div class="column">
                    <div class="column_title">
                        <h1 class="canban_text">Новое</h1>
                    </div>
                    <hr>
                    <div class="colomn_task_block">
                        <div class="task glass-block">
                            <h1 class="name task_text">Название</h1>
                            <h1 class="discription task_text">Какое-то очень длинное и информативное описание бла бла бла бла бла бла</h1>
                            <hr>
                            <div class="subtask">
                                <input type="checkbox" class="glass-input-checkbox" name="" id="">
                                <h1 class="subtask_title task_text">Подзадача</h1>
                            </div>
                            <div class="subtask">
                                <input type="checkbox" class="glass-input-checkbox" name="" id="">
                                <h1 class="subtask_title task_text">Подзадача с каким-то очень длинным текстом не на одну строчку</h1>
                            </div>
                            <hr>
                            <h1 class="deadline task_text">Срок: 31.12.2025 17:55</h1>
                            <div class="tegs">
                                <div class="teg glass-block">
                                    <h1 class="tegs_text task_text">Важное</h1>
                                </div>
                                <div class="teg glass-block">
                                    <h1 class="tegs_text task_text">Быстрое</h1>
                                </div>
                                <div class="teg glass-block">
                                    <h1 class="tegs_text task_text">Семейное</h1>
                                </div>
                            </div>
                            

                        </div>
                    </div>
                </div>

                <div class="add_category">

                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        async function setHTMLWithScripts(container, html) {
            container.innerHTML = html;

            const scripts = Array.from(container.querySelectorAll("script"));

            for (const oldScript of scripts) {
                const newScript = document.createElement("script");

                // копируем атрибуты
                for (const attr of oldScript.attributes) {
                    newScript.setAttribute(attr.name, attr.value);
                }

                if (oldScript.src) {
                    // ВАЖНО: ждём загрузку src
                    await new Promise((resolve, reject) => {
                        newScript.onload = resolve;
                        newScript.onerror = reject;
                        document.body.appendChild(newScript);
                    });
                } else {
                    // inline — выполняем после загрузки всех src выше
                    newScript.textContent = oldScript.textContent;
                    document.body.appendChild(newScript);
                }

                oldScript.remove();
            }
        }


        async function open_create_task_page() {
            const data = await request({
                url: "/task/create/",
            });

            const view = document.querySelector('.view_task_section');
            view.innerHTML = '';
            await setHTMLWithScripts(view, data);
            view.style.display = "block";
        }


        // request({
        //     url: 'category/list/',
        // }).then(data => {
        //     console.log(data);
        //     let right_panel = document.querySelector('.right_panel');
        //     for (let i = 0; i < data.length; i++) {
        //         right_panel.insertAdjacentHTML('afterbegin', `
        //             <div class="block glass-block" data-id='${data[i].id}'>
        //                 <h1 class="button_text">${data[i].name}</h1>
        //             </div>
        //         `);
        //     }
        // })
    </script>
{% endblock %}
